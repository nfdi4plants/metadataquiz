<!DOCTYPE html>
<html lang="en">
		<head>
		<meta http-equiv="Content-Type" charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Metadata recommendation tool is developed by DataPLANT and IBG-4 of Research Center Jülich. The motivation is to make metadata annotation more approachable. To support researchers with metadata annotation over the entire investigation lifecycle.">
		<meta name="keywords" content="Metadata, tool, metadata completeness, minimal standard">
		
		<!-- disable cache accross browsers for testing purpose -->
		
		<meta http-equiv="Expires" content="0" />
		<title>Metadata recommendation Tool</title>
		
		<!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
		<!-- loading css styleSheets -->

		<link href="css/bootstrap.min.css" rel="stylesheet"/>
        <link href="css/custom.css" rel="stylesheet"/>
		<script src="js/bootstrap.bundle.min.js" type="text/javascript" charset="utf-8"> </script>		
		<link href="favicon.png" rel="icon">
		
		<style>
      .smallRef{
        font-size: 0.7rem;
        line-height: 0.9rem;
      }
      .description{
        font-size: 0.9rem;
        line-height: 1.1rem;
      }
      button:disabled{
          border: 1px solid #999999 !important;
          background-color: #377d98 !important;
          opacity:1 !important;
          color: #FFFFFF !important;
        }
        table{
          table-layout: fixed;
        }
        th,
        td {
          border: 1px solid black;
          #width: 20vw !important;
          overflow: hidden;
        }
		</style>
			</head>
			
		<body  class="d-grid gap-5" style="background: rgb(45, 62, 80, 0.2); "  >
		
	
				<div class="row" style="background: rgb(45, 62, 80); height: 3.25rem; margin: 0 0 0 0px; padding: 0 0 0 0; ">
					<a class="" href="https://nfdi4plants.org/" >
						<img src="images/logo.png" alt="Logo" width="32" height="32" style="position: absolute; margin: 8px 12px 8px 12px; left: 0px; padding-top: 0px;" />
					</a>
					
					<div class="justify-content-center row d-flex align-items-center" style="margin: 0 0 0 0; ; padding: 0 0 0 0; height: 3.25rem;  ">
						<div class="btn-group d-md-none g-0 dropdown col-auto d-flex align-items-center" >
							<button type="button" class="btn rounded-0 border-0 g-0 btn-nav " data-bs-toggle="dropdown" aria-expanded="false" id="menu">
								Menu &nbsp;
								<span style="display: inline-block; color: rgb(79, 179, 217); letter-spacing: 2px; font-size: 1em; transform: scaleX(2); transform-origin: 1 0;"> ∨ </span>
							</button>
							<ul class="dropdown-menu">
							<li>
									<a id="metadata1" class="dropdown-item" href="https://github.com/xiaoranzhou/metadata">github source code</a>
								</li>
                               
							</ul>
						</div>

						<div class="btn-group d-none g-0 d-md-block dropdown col-auto"  >
							<button type="button" class="btn border-0 rounded-0 g-0 btn-nav" data-bs-toggle="dropdown" aria-expanded="false" id="metadataMenu" >
								Menu &nbsp;

								<span style="display: inline-block; color: rgb(79, 179, 217); letter-spacing: 2px; font-size: 1em; transform: scaleX(2); transform-origin: 1 0;"> ∨ </span>
							</button>
							<ul class="dropdown-menu" >
								<li>
									<a id="metadata2" class="dropdown-item" href="https://github.com/xiaoranzhou/metadata">github source code</a>
								</li>
                                
							</ul>
						</div>

						
					</div>
				</div>
				
                <div id="q1" class="container-sm d-grid gap-3" >
                  <h2 class=" d-flex justify-content-center "> Metadata Quiz </h2>
                  <div class=" d-flex justify-content-center ">
                    This quiz is meant to help you find the metadata checklists and endpoint repositories best suited for your data. <br>
                  </div>
                  
                    <div class=" d-flex justify-content-center ">
                      
                        <h4>What type of organism(s) will you be working with?</h4> 
                    </div>
                    
                    <div class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="PlantCheck" checked=true>
                        <label class="form-check-label" for="PlantCheck">
                          Plant
                        </label>
                      </div>
                      
                      
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="FungusCheck">
                        <label class="form-check-label" for="FungusCheck">
                          Fungus
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="BacteriaCheck">
                        <label class="form-check-label" for="BacteriaCheck">
                          Bacteria
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="VirusCheck">
                        <label class="form-check-label" for="VirusCheck">
                          Virus
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="AnimalCheck">
                        <label class="form-check-label" for="AnimalCheck">
                          Animal
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="EnvironmentalCheck">
                        <label class="form-check-label" for="EnvironmentalCheck">
                          Environmental
                        </label>
                      </div>
                    </div>
                </div>
			

                <div id="q2" class="container-sm d-grid gap-3" >
                    <div class=" d-flex justify-content-center ">
                      <h4>What environment(s) will the experiment(s) take place in?</h4> 
                    </div>
                    
                    <div class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="FieldCheck">
                        <label class="form-check-label" for="FieldCheck">
                          In the field
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="GlasshouseCheck">
                        <label class="form-check-label" for="GlasshouseCheck">
                          Greenhouse/glasshouse
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ChamberCheck">
                        <label class="form-check-label" for="ChamberCheck">
                          Controlled environment chamber
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="IncubatorCheck">
                        <label class="form-check-label" for="IncubatorCheck">
                          Incubator
                        </label>
                      </div>
                    </div>
                </div>

                <div class="container-sm d-grid gap-3" >
                    <div class=" d-flex justify-content-center ">
                        <h4>What type(s) of data will be collected?</h4> 
                    </div>
                    
                    <div id="q3" class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="PhenotypicCheck" >
                        <label class="form-check-label" for="PhenotypicCheck">
                          Phenotypic
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="GenomicCheck" >
                        <label class="form-check-label" for="GenomicCheck">
                          Genomic
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="TranscriptomicCheck" >
                        <label class="form-check-label" for="TranscriptomicCheck">
                          Transcriptomic
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox"  value="" id="MetabolomicCheck" >
                        <label class="form-check-label" for="MetabolomicCheck">
                          Metabolomic
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ProteomicCheck" >
                        <label class="form-check-label" for="ProteomicCheck">
                          Proteomic
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ModelCheck" >
                        <label class="form-check-label" for="ModelCheck">
                          Model
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ImagesCheck" >
                        <label class="form-check-label" for="ImagesCheck">
                          Images
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="OthersCheck" >
                        <label class="form-check-label" for="OthersCheck">
                          Others
                        </label>
                      </div>
                    </div>
                </div>  <!-- Button trigger modal -->
                <div class="d-flex justify-content-center">                   
                <button type="button" id="submission" class="btn btn-primary btn-lg" onclick="updateSuggestions(googleJSON)" data-bs-toggle="modal" data-bs-target="#suggestionModal" disabled>Click here to get metadata checklist suggestions</button> 
                </div>
              


        <!-- Modal -->
        <div class="modal modal-xl fade" id="suggestionModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="suggestionModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="suggestionModalLabel">Based on your answers, we think the following information can be a good starting point for your metadata annotation:</h5>
                
                
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <span class="m-3" >The information in this table focuses on the most common plant experiments. If this quiz does not fit your experimental setup, you will still be able to use the DataPLANT tools, such as Swate and ARCitect, to manage your data.</span>
              <div class="modal-body">
                <table class="table table-hover">
                  <thead>
                    <th scope="col " class="col-2">
                      Domain
                    </th>
                    <th scope="col " class="col-3">
                      Repositories
                    </th>
                    <th scope="col " class="col-3">
                    Minimum Information Standards
                    </th>
                    <th scope="col " class="col-3">
                      SWATE Templates
                    </th>
                  </thead>  

                <tbody  id="suggestionContent">
                  
                </body>
              </table>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-primary">Understood</button>-->
              </div>
            </div>
          </div>
        </div>
	  </body>		
    <script src="js/metadata.js"></script>
    <script>
      //console.log(metadata);
      var googleJSON;

      function csvJSON(csv){

        var lines=csv.split("\n");

        var result = [];
        var headers=lines[0].split(",");

        for(var i=1;i<lines.length;i++){

            var obj = {};
            var currentline=lines[i].split(",");

            for(var j=0;j<headers.length;j++){
                obj[headers[j]] = currentline[j];
            }

            result.push(obj);

        }

        //return result; //JavaScript object
        return JSON.stringify(result); //JSON
        }

      async function fetchGoogleCSV(){
        try {
          //read .csv file on a server
          const target = `https://docs.google.com/spreadsheets/d/e/2PACX-1vRCAlGxBM7PSg4x6Di4cWHH4B6m1eKFXyPwWOdBpEkS2P5h0JU9YGdyoftIxqwEAcnA0Np3t-CrScBZ/pub?gid=0&single=true&output=csv`;

          const res = await fetch(target, {
           
              method: 'get',
              headers: {
                
                  'content-type': 'text/csv;charset=UTF-8',
              }
          });

          if (res.status === 200) {
              const data = await res.text();
              googleJSON =JSON.parse(csvJSON(data)),
              document.getElementById("submission").disabled = false;

          } else {
              console.log(`Error code ${res.status}`);
          }
      } catch (err) {
          console.log(err)
      }

      }
      
      fetchGoogleCSV()
        .then(metadata = googleJSON)
        .catch(err => {consloe.log("fetch of google csv failed, error is ", err)})

      function updateSuggestions(metadata){
        let suggestionContent = document.getElementById("suggestionContent");
        suggestionContent.innerHTML= "";
        function getChecked(nodes){
         let ids=[];
         nodes.forEach(function (ele, index){
            if (ele.checked == true){
            ids.push(ele.id.split("Check")[0]);
          }
          }) ;          
          return ids;
        }
        const q1 = document.getElementById("q1").querySelectorAll(".form-check-input");
        const q2 = document.getElementById("q2").querySelectorAll(".form-check-input");
        const q3 = document.getElementById("q3").querySelectorAll(".form-check-input");
        let q1Ids = getChecked(q1);
        let q2Ids = getChecked(q2);
        let q3Ids = getChecked(q3);
        
        let repoText  =   ["","","","","","","",""];
        let misText   =   ["","","","","","","",""];
        let swateText =   ["","","","","","","",""];
        
        
          
          for ( const  [index, element] of metadata.entries() ){
            const list = element.q1.replaceAll(" ", "").split(";");


            if (list.some((ids) => q1Ids.includes(ids))) {

              for (const idd in q3Ids){
              
              if (element["biological data domain"].toLowerCase().includes(q3Ids[idd].toLowerCase())){
                console.log(element["biological data domain"]+ " include "+ q3Ids[idd].toLowerCase())
                var loc;
                switch(q3Ids[idd].toLowerCase()){
                 case "phenotypic":
                  loc = 0;
                  break;
                  case "genomic":
                  loc = 1;
                  break;
                  case "transcriptomic":
                  loc = 2;
                  break;
                  case "metabolomic":
                  loc = 3;
                  break;
                  case "proteomic":
                  loc = 4;
                  break;
                  case "model":
                  loc = 5;
                  break;
                  case "images":
                  loc = 6;
                  break;
                  case "others":
                  loc = 7;
                  break;
                }
                const description = ((element.description == element.acronym)||(element.description==""))? "":"<span class='description'>&nbsp("+element.description +")</span>";
                const metadataLink = (element.link=="")?"":"<br> <a href='"+element.link +"' target='_blank' class='smallRef'> Click here to learn more about "+ element.acronym +"</a>";
                const metadataSubmission = (element.submission=="")?"":"<br> <a href='"+element.submission +"' target='_blank' class='smallRef'> Click here for metadata list </a>";
                const submissionLink = (element.submission=="")?"":"<br> <a href='"+element.submission +"' target='_blank' class='smallRef'> Click here for submission </a>";

                switch(element.type){
                  case "Repository":
                    repoText[loc] += "<b>"+element.acronym + "</b>"+ 
                    description +
                    metadataLink +
                    submissionLink+
                    "<br>";
                  break;
                  case "Minimum Information standards":
                   misText[loc] +=   "<b>"+element.acronym + "</b>"+ 
                   description +
                   metadataLink+
                   metadataSubmission+
                    "<br>";
                   break;
                   case "Template":
                   swateText[loc] +=   "<b>"+element.description + "</b> <span class='description'> </span>"+
                   "<br><a href='"+element["template"] +"' target='_blank' class='smallRef'>"+
                    " Click here to access the SWATE template for "+element.description +"</a> <br> ";
                   break;
                }
                
              
                
              }
              

            }
  



          } 


        }

          
        for (const idd in q3Ids){
            var loc;
                switch(q3Ids[idd].toLowerCase()){
                 case "phenotypic":
                  loc = 0;
                  break;
                  case "genomic":
                  loc = 1;
                  break;
                  case "transcriptomic":
                  loc = 2;
                  break;
                  case "metabolomic":
                  loc = 3;
                  break;
                  case "proteomic":
                  loc = 4;
                  break;
                  case "model":
                  loc = 5;
                  break;
                  case "images":
                  loc = 6;
                  break;
                  case "others":
                  loc = 7;
                  break;
                  
                }
                  var htmlText = `<tr>
                                    <td>
                                      `+q3Ids[idd]+` 
                                    </td>
                                    <td>
                                      `+repoText[loc]+`
                                    </td>
                                    <td>
                                      `+misText[loc]+`
                                    </td>
                                    <td>
                                      `+swateText[loc]+`
                                    </td>
                                  </tr>
                                  `
                suggestionContent.innerHTML += htmlText;
             }


      }

      </script>
</html>
