<!DOCTYPE html>
<html lang="en" >
		<head>
		<meta http-equiv="Content-Type" charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Metadata recommendation tool is developed by DataPLANT and IBG-4 of Research Center Jülich. The motivation is to make metadata annotation more approachable. To support researchers with metadata annotation over the entire investigation lifecycle.">
		<meta name="keywords" content="Metadata, tool, metadata completeness, minimal standard">
		
		<!-- disable cache accross browsers for testing purpose -->
		
		<meta http-equiv="Expires" content="0" />
		<title>Metadata recommendation Tool</title>
		
		<!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
		<!-- loading css styleSheets -->

		<link href="css/bootstrap.min.css" rel="stylesheet"/>
        <link href="css/custom1507.css" rel="stylesheet"/>
		<script src="js/bootstrap.bundle.min.js" type="text/javascript" charset="utf-8"> </script>		
		<link href="favicon.png" rel="icon">
		
		<style>
      body{
        font-size: 1.0rem;
      }
      .custom-popover {
        --bs-popover-max-width: 500px;
        --bs-popover-border-color: var(--bs-primary);
        --bs-popover-header-bg: var(--bs-primary);
        --bs-popover-header-color: var(--bs-white);
        --bs-popover-body-padding-x: 1rem;
        --bs-popover-body-padding-y: .5rem;
      }
      .smallRef{
        font-size: 0.7rem;
        line-height: 0.9rem;
      }
      .description{
        font-size: 0.9rem;
        line-height: 1.2rem;
        padding-top: 0.5rem;
        display:inline;
      }
      button:disabled{
          border: 1px solid #999999 !important;
          background-color: #377d98 !important;
          opacity:1 !important;
          color: #FFFFFF !important;
        }
        table{
          table-layout: fixed;
        }
        th,
        td {
          border: 1px solid black;
          #width: 20vw !important;
          overflow: hidden;
        }
		</style>
			</head>
			
		<body  class="d-grid gap-4 mx-4"   >
		
	
				<div class="row d-none" style="background: rgb(45, 62, 80); height: 3.25rem; margin: 0 0 0 0px; padding: 0 0 0 0; ">
					<a class="" href="https://nfdi4plants.org/" >
						<img src="images/logo.png" alt="Logo" width="32" height="32" style="position: absolute; margin: 8px 12px 8px 12px; left: 0px; padding-top: 0px;" />
					</a>
					
					<div class="justify-content-center row d-flex align-items-center" style="margin: 0 0 0 0; ; padding: 0 0 0 0; height: 3.25rem;  ">
						<div class="btn-group d-md-none g-0 dropdown col-auto d-flex align-items-center" >
							<button type="button" class="btn rounded-0 border-0 g-0 btn-nav " data-bs-toggle="dropdown" aria-expanded="false" id="menu">
								Menu &nbsp;
								<span style="display: inline-block; color: rgb(79, 179, 217); letter-spacing: 2px; font-size: 1em; transform: scaleX(2); transform-origin: 1 0;"> ∨ </span>
							</button>
							<ul class="dropdown-menu">
							<li>
									<a id="metadata1" class="dropdown-item" href="https://github.com/xiaoranzhou/metadata">github source code</a>
								</li>
                               
							</ul>
						</div>

						<div class="btn-group d-none g-0 d-md-block dropdown col-auto"  >
							<button type="button" class="btn border-0 rounded-0 g-0 btn-nav" data-bs-toggle="dropdown" aria-expanded="false" id="metadataMenu" >
								Menu &nbsp;

								<span style="display: inline-block; color: rgb(79, 179, 217); letter-spacing: 2px; font-size: 1em; transform: scaleX(2); transform-origin: 1 0;"> ∨ </span>
							</button>
							<ul class="dropdown-menu" >
								<li>
									<a id="metadata2" class="dropdown-item" href="https://github.com/xiaoranzhou/metadata">github source code</a>
								</li>
                                
							</ul>
						</div>

						
					</div>
				</div>
				
                <div id="q1" class="container-lg d-grid gap-3" >
                  <h3 class=" d-flex justify-content-center "> Metadata Quiz </h3>
                  <div class=" d-flex justify-content-center ">
                    This quiz is meant to help you find the metadata checklists and endpoint repositories best suited for your data. <br>
                  </div>
                  
                    <div class=" d-flex justify-content-center ">
                      
                        <h4>What type of organism(s) will you be working with?</h4> 
                    </div>
                    
                    <div class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="PlantCheck" checked=true>
                        <label class="form-check-label" for="PlantCheck">
                          Plant
                        </label>
                      </div>
                      
                      
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="FungusCheck">
                        <label class="form-check-label" for="FungusCheck">
                          Fungus
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="BacteriaCheck">
                        <label class="form-check-label" for="BacteriaCheck">
                          Bacteria
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="VirusCheck">
                        <label class="form-check-label" for="VirusCheck">
                          Virus
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="AnimalCheck">
                        <label class="form-check-label" for="AnimalCheck">
                          Animal
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="EnvironmentalCheck">
                        <label class="form-check-label" for="EnvironmentalCheck">
                          Environmental
                        </label>
                      </div>
                    </div>
                </div>
			

                <div id="q2" class="container-lg d-grid gap-3" >
                    <div class=" d-flex justify-content-center ">
                      <h4>What environment(s) will the experiment(s) take place in?</h4> 
                    </div>
                    
                    <div class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="FieldCheck">
                        <label class="form-check-label" for="FieldCheck">
                          In the field
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="GlasshouseCheck">
                        <label class="form-check-label" for="GlasshouseCheck">
                          Greenhouse/glasshouse
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ChamberCheck">
                        <label class="form-check-label" for="ChamberCheck">
                          Controlled environment chamber
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="IncubatorCheck">
                        <label class="form-check-label" for="IncubatorCheck">
                          Incubator
                        </label>
                      </div>
                    </div>
                </div>

                <div class="container-lg d-grid gap-3" >
                    <div class=" d-flex justify-content-center ">
                        <h4>What type(s) of data will be collected?</h4> 
                    </div>
                    
                    <div id="q3" class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="PhenotypicCheck" >
                        <label class="form-check-label" for="PhenotypicCheck">
                          Phenotypic
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="GenomicCheck" >
                        <label class="form-check-label" for="GenomicCheck">
                          Genomic
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="TranscriptomicCheck" >
                        <label class="form-check-label" for="TranscriptomicCheck">
                          Transcriptomic
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox"  value="" id="MetabolomicCheck" >
                        <label class="form-check-label" for="MetabolomicCheck">
                          Metabolomic
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ProteomicCheck" >
                        <label class="form-check-label" for="ProteomicCheck">
                          Proteomic
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ModelCheck" >
                        <label class="form-check-label" for="ModelCheck">
                          Model
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ImagesCheck" >
                        <label class="form-check-label" for="ImagesCheck">
                          Images
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="OthersCheck" >
                        <label class="form-check-label" for="OthersCheck">
                          Others
                        </label>
                      </div>
                    </div>
                </div>  
                
                <div class="container-lg d-grid gap-3" >
                    <div class=" d-flex justify-content-center ">
                        <h4>What archive or repository are you planning on uploading your data to?</h4> 
                    </div>
                    
                    <div id="q4" class="row justify-content-md-center">
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ENACheck" >
                        <label class="form-check-label" for="ENACheck">
                          ENA
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="GEOCheck" >
                        <label class="form-check-label" for="GEOCheck">
                          GEO
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="PRIDECheck" >
                        <label class="form-check-label" for="PRIDECheck">
                          PRIDE
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox"  value="" id="MetaboLightsCheck" >
                        <label class="form-check-label" for="MetaboLightsCheck">
                          MetaboLights
                        </label>
                      </div>

                      <!-- <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ProteomicCheck" >
                        <label class="form-check-label" for="ProteomicCheck">
                          Proteomic
                        </label>
                      </div>

                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ModelCheck" >
                        <label class="form-check-label" for="ModelCheck">
                          Model
                        </label>
                      </div>
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="ImagesCheck" >
                        <label class="form-check-label" for="ImagesCheck">
                          Images
                        </label>
                      </div> -->
                      <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="RPOthersCheck" >
                        <label class="form-check-label" for="RPOthersCheck">
                          Others
                        </label>
                      </div>
                                            <div class="col-auto form-check   form-check-inline">
                        <input class="form-check-input" type="checkbox" value="" id="IDKCheck" >
                        <label class="form-check-label" for="IDKCheck">
                          I don’t know
                        </label>
                      </div>
                    </div>
                </div>
                
                
                <!-- Button trigger modal -->
                <div class="d-flex justify-content-center">                   
                <button type="button" id="submission" class="btn btn-primary btn-lg" onclick="updateSuggestions(googleJSON)" data-bs-toggle="modal" data-bs-target="#suggestionModal" disabled>Click here to get metadata checklist suggestions</button> 
                </div>
              


        <!-- Modal -->
        <div class="modal modal-xl fade" id="suggestionModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="suggestionModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-fullscreen-xxl-down modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="suggestionModalLabel">Your starting point for metadata annotation   <a type="button" data-bs-custom-class="custom-popover" data-bs-html="true" data-bs-toggle="popover" data-bs-placement="right" data-bs-content='Based on your answers, we think the following information can be a good starting point for your metadata annotation. The information in this table focuses on the most common plant experiments. If this quiz does not fit your experimental setup, you will still be able to use the DataPLANT tools, such as <a href="https://nfdi4plants.org/nfdi4plants.knowledgebase/vault/swate-quickstart/" target="_blank" class="text-success"><b>Swate</b></a> and <a href="https://nfdi4plants.github.io/nfdi4plants.knowledgebase/arcitect/" target="_blank" class="text-success"><b>ARCitect</b></a>, to manage your data. Are you looking for a template to help describe the columns within your data sheet? Try creating a <a href="https://nfdi4plants.github.io/nfdi4plants.knowledgebase/start-here/datamap" target="_blank" class="text-success"><b>datamap</b></a> instead!' class="text-success">&#128712;</a> 
                
                </h5>
                
                
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              
              <div class="modal-body">
                <table class="table table-hover">
                  <thead>
                    <th scope="col " class="col-2">
                      Domain
                    </th>
                    <th scope="col " class="col-3">
                      Repositories
                    </th>
                    <th scope="col " class="col-3">
                    Minimum Information Standards
                    </th>
                    <th scope="col " class="col-3">
                      SWATE Templates
                    </th>
                  </thead>  

                <tbody  id="suggestionContent">
                  
                </body>
              </table>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-primary">Understood</button>-->
              </div>
            </div>
          </div>
        </div>
	  </body>		
    <script src="js/metadata.js"></script>
    <script>
      //console.log(metadata);
      const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
      const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
      var googleJSON;

      function csvJSON(csv){

        var lines=csv.split("\n");

        var result = [];
        var headers=lines[0].split(",");

        for(var i=1;i<lines.length;i++){

            var obj = {};
            var currentline=lines[i].split(",");

            for(var j=0;j<headers.length;j++){
                obj[headers[j]] = currentline[j];
            }

            result.push(obj);

        }

        //return result; //JavaScript object
        return JSON.stringify(result); //JSON
        }

      async function fetchGoogleCSV(){
        try {
          //read .csv file on a server
          const target = `https://docs.google.com/spreadsheets/d/e/2PACX-1vRCAlGxBM7PSg4x6Di4cWHH4B6m1eKFXyPwWOdBpEkS2P5h0JU9YGdyoftIxqwEAcnA0Np3t-CrScBZ/pub?gid=0&single=true&output=csv`;
          const res = await fetch(target, {
              method: 'get',
              headers: {
                
                  'content-type': 'text/csv;charset=UTF-8',
              }
          });

          if (res.status === 200) {
              const data = await res.text();
              googleJSON =JSON.parse(csvJSON(data)),
              document.getElementById("submission").disabled = false;

          } else {
              console.log(`Error code ${res.status}`);
          }
      } catch (err) {
          console.log(err)
      }

      }
      
      fetchGoogleCSV()
        .then(metadata = googleJSON)
        .catch(err => {consloe.log("fetch of google csv failed, error is ", err)})

      function updateSuggestions(metadata){
        let suggestionContent = document.getElementById("suggestionContent");
        suggestionContent.innerHTML= "";
        function getChecked(nodes){
         let ids=[];
         nodes.forEach(function (ele, index){
            if (ele.checked == true){
            ids.push(ele.id.split("Check")[0]);
          }
          }) ;          
          return ids;
        }
        const q1 = document.getElementById("q1").querySelectorAll(".form-check-input");
        const q2 = document.getElementById("q2").querySelectorAll(".form-check-input");
        const q3 = document.getElementById("q3").querySelectorAll(".form-check-input");
        const q4 = document.getElementById("q4").querySelectorAll(".form-check-input");
        let q1Ids = getChecked(q1);
        let q2Ids = getChecked(q2);
        let q3Ids = getChecked(q3);
        let q4Ids = getChecked(q4);
        
        let repoText  =   ["","","","","","","",""];
        let misText   =   ["","","","","","","",""];
        let swateText =   ["","","","","","","",""];
        
        
          

        
          for ( const  [index, element] of metadata.entries() ){
            const list = element.q1.replaceAll(" ", "").split(";");


            if (list.some((ids) => q1Ids.includes(ids))) {

              for (const idd in q3Ids){
              
              if (element["biological data domain"].toLowerCase().includes(q3Ids[idd].toLowerCase()) && ( q4Ids.some(keyword => element.description.toLowerCase().includes(keyword.toLowerCase()) ) || q4Ids.length == 0 || q4Ids.includes("IDK") || q4Ids.includes("RPOther")   )){
                console.log(element["biological data domain"]+ " include "+ q3Ids[idd].toLowerCase())
                var loc;
                switch(q3Ids[idd].toLowerCase()){
                 case "phenotypic":
                  loc = 0;
                  break;
                  case "genomic":
                  loc = 1;
                  break;
                  case "transcriptomic":
                  loc = 2;
                  break;
                  case "metabolomic":
                  loc = 3;
                  break;
                  case "proteomic":
                  loc = 4;
                  break;
                  case "model":
                  loc = 5;
                  break;
                  case "images":
                  loc = 6;
                  break;
                  case "others":
                  loc = 7;
                  break;
                }
                const description = ((element.description == element.acronym)||(element.description==""))? "":"<span class='description'>&nbsp("+element.description +")</span>";
                const metadataLink = (element.link=="")?"":" <span class='smallRef'> Click  <a href='"+element.link +"' class='text-success' target='_blank' >here</a> to learn more about "+ element.acronym +"</span>";
                const metadataSubmission = (element.submission=="")?"":"<br> <span class='smallRef'> Click <a href='"+element.submission +"' target='_blank' class='text-success' >here</a> for metadata list</span>";
                const submissionLink = (element.submission=="")?"":"<span class='smallRef'> Click <br> <a href='"+element.submission +"' target='_blank' class='text-success' >here</a> for submission </span>>";

                switch(element.type){
                  case "Repository":
                    repoText[loc] += "<p><span class='description'><b>"+element.acronym + "</b></span>"+ 
                    description +"</p>" +
                    metadataLink +
                    submissionLink+
                    "<br>";
                  break;
                  case "Minimum Information standards":
                   misText[loc] +=   "<p><span class='description'><b>"+element.acronym + "</b></span>"+ 
                   description +"</p>"+
                   metadataLink+
                   metadataSubmission+
                    "<br>";
                   break;
                   case "Template":
                   swateText[loc] +=   "<p><span class='description'><b>"+element.description + "</b></span> <span class='description'> </span></p>"+
                   "<span class='smallRef'> Click <a class='text-success' href='"+element["template"] +"' target='_blank' >here</a> to access the SWATE template for "+element.description +" <br> </span>";
                   break;
                }
                
              
                
              }              
            }
          } 
        }

          
        for (const idd in q3Ids){
            var loc;
                switch(q3Ids[idd].toLowerCase()){
                 case "phenotypic":
                  loc = 0;
                  break;
                  case "genomic":
                  loc = 1;
                  break;
                  case "transcriptomic":
                  loc = 2;
                  break;
                  case "metabolomic":
                  loc = 3;
                  break;
                  case "proteomic":
                  loc = 4;
                  break;
                  case "model":
                  loc = 5;
                  break;
                  case "images":
                  loc = 6;
                  break;
                  case "others":
                  loc = 7;
                  break;
                  
                }
                  var htmlText = `<tr>
                                    <td>
                                      `+q3Ids[idd]+` 
                                    </td>
                                    <td>
                                      `+repoText[loc]+`
                                    </td>
                                    <td>
                                      `+misText[loc]+`
                                    </td>
                                    <td>
                                      `+swateText[loc]+`
                                    </td>
                                  </tr>
                                  `
                suggestionContent.innerHTML += htmlText;
             }


      }

      </script>
</html>
